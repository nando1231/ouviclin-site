<script>
(function() {
    // 1. Configurações (Chaves já atualizadas com os dados que enviou)
    const SB_URL = "https://pvlkipwpdosvbyjhyysn.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2bGtpcHdwZG9zdmJ5amh5eXNuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MjQxMTEsImV4cCI6MjA4NTEwMDExMX0.g0L6XvzJESiaEoia9K9e_ARBUzsABbUlljnv-tyg_l4";
    
    // 2. Inicialização com nome único para evitar o SyntaxError
    const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

    document.querySelectorAll(".gpc_botao.e_formulario").forEach(button => {
        button.addEventListener("click", async (e) => {
            // BLOQUEIA O ERRO: Impede o script antigo de dar erro 404
            e.preventDefault();
            e.stopPropagation();
            
            const form = button.closest("form");
            if (!form) return;
            
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => { data[key] = value; });
            
            // Feedback visual no botão
            const originalText = button.innerText;
            button.innerText = "Enviando...";

            try {
                // Envia para a tabela 'leads'
                const { error } = await supabaseClient.from("leads").insert([data]);
                if (error) throw error;
                
                console.log("Lead salvo no Supabase!");
                alert("Agendamento solicitado com sucesso!");
                form.reset();
            } catch (err) {
                console.error("Erro ao salvar lead:", err.message);
                alert("Erro técnico: Verifique se o RLS está desativado no Supabase.");
            } finally {
                button.innerText = originalText;
            }
        }, true); // O 'true' faz o nosso código rodar antes do script de erro do site
    });
})();
</script>
